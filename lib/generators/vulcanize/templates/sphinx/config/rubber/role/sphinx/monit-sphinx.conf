<%
  @path = '/etc/monit/monit.d/monit-sphinx.conf'
%>

check process sphinx with pidfile <%= RUBBER_ROOT %>/log/searchd.<%= RUBBER_ENV %>.pid
  group sphinx-<%= RUBBER_ENV %>
  start program = "/usr/bin/sudo -H -u #{rubber_env.app_user} bash -l -c 'cd <%= RUBBER_ROOT %> RAILS_ENV=<%= RUBBER_ENV %> rake ts:start'"
  stop program  = "/usr/bin/sudo -H -u #{rubber_env.app_user} bash -l -c 'cd <%= RUBBER_ROOT %> RAILS_ENV=<%= RUBBER_ENV %> rake ts:stop'"
  if failed host <%= rubber_env.host %> port 3312 with timeout 5 seconds for 5 cycles then restart

